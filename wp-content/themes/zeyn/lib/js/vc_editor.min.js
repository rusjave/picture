jQuery(document).ready(function(e){"use strict";function t(t){t.preventDefault();var i=e(this),a=i.closest(".attach_video_field"),d=e("a.gallery_widget_add_video",a),r=d.find("video").data("id"),n=a.find("input").val();n=""==n?new Array:n.split(/,/);for(var l=0;l<n.length;l++)n[l]==r&&n.splice(l,1);d.html(d.attr("title")),a.find("input").val("").trigger("change"),i.hide()}var i=window.dtb_i18nLocale;wp.media.DethemeVideoEdit={getData:function(){return this.formfield.val()},set:function(t){if(this.getData()==t.get("id"))return!1;var i=e('<video autoplay data-id="'+t.get("id")+'" width="266"/>'),a=e("<source/>"),d=t.attributes.mime,r=t.attributes.thumb.src;return a.attr("src",t.attributes.url),a.attr("type",d),i.attr("poster",r),i.append(a),this.preview.find("a.gallery_widget_add_video").html(i),this.formfield.val(t.get("id")).trigger("change"),this.field.find(".remove_attach_video").show(),!1},frame:function(e){var a=(e.find(".gallery_widget_add_video"),e.find(".remove_attach_video")),d=(e.find("input"),e.find(".gallery_widget_attached_videos_list li"));return this.field=e,this.formfield=e.find("input"),this.preview=d,a.click(t),this._frame?this._frame:(this._frame=wp.media({id:"detheme_image",state:"insert-image",title:i.insert_video,editing:!0,multiple:!1,toolbar:"insert-image",menu:"insert-image",type:"image",states:[new wp.media.controller.DethemeVideoEdit]}),this._frame.on("toolbar:create:insert-image",function(e){this.createSelectToolbar(e,{text:i.select_video})},this._frame),this._frame.state("insert-image").on("select",this.select),this._frame)},select:function(){var e=this.get("selection").single();wp.media.DethemeVideoEdit.set(e?e:-1)}},wp.media.controller.DethemeVideoEdit=wp.media.controller.FeaturedImage.extend({defaults:_.defaults({id:"insert-image",filterable:"uploaded",multiple:!1,toolbar:"insert-image",library:wp.media.query({type:"video"}),title:i.select_video,priority:60,syncSelection:!1},wp.media.controller.Library.prototype.defaults),updateSelection:function(){var e,t=this.get("selection"),i=wp.media.DethemeVideoEdit.getData();""!==i&&-1!==i&&(e=wp.media.model.Attachment.get(i),e.fetch()),t.reset(e?[e]:[])}}),e(".attach_video_field").length&&e(".attach_video_field").each(function(){var i=e(this);i.find(".gallery_widget_add_video").unbind("click").click(function(){wp.media.DethemeVideoEdit.frame(i).open()}),i.find(".remove_attach_video").unbind("click").click(t)})});