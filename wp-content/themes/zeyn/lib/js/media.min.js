jQuery(document).ready(function(e){"use strict";function t(t){t.preventDefault();var i=e(this),a=i.closest(".detheme-field-image"),m=e(".add_detheme_image",a),d=m.find("img").data("id"),r=a.find("input").val();r=""==r?new Array:r.split(/,/);for(var n=0;n<r.length;n++)r[n]==d&&r.splice(n,1);m.html(m.attr("title")),a.find("input").val("").trigger("change"),i.hide()}var i=window.dtb_i18nLocale;wp.media.DethemeImageEdit={getData:function(){return this.formfield.val()},set:function(t){var i=e('<img data-id="'+t.get("id")+'" width="266" src="'+t.attributes.url+'"/>');return this.preview.find("a").html(i),this.formfield.val(t.get("id")).trigger("change"),this.field.find(".remove_detheme_image").show(),!1},frame:function(a){var m=(a.find(".add_detheme_image"),a.find(".remove_detheme_image")),d=(a.find("input"),a.find(".preview-image"));return d.length||(d=e("<p></p>").addClass("preview-image"),a.prepend(d)),this.field=a,this.formfield=a.find("input"),this.preview=d,m.click(t),this._frame?this._frame:(this._frame=wp.media({id:"detheme_image",state:"insert-image",title:i.insert_image,editing:!0,multiple:!1,toolbar:"insert-image",menu:"insert-image",type:"image",states:[new wp.media.controller.DethemeImageEdit]}),this._frame.on("toolbar:create:insert-image",function(e){this.createSelectToolbar(e,{text:i.select_image})},this._frame),this._frame.state("insert-image").on("select",this.select),this._frame)},select:function(){var e=this.get("selection").single();wp.media.DethemeImageEdit.set(e?e:-1)}},wp.media.controller.DethemeImageEdit=wp.media.controller.FeaturedImage.extend({defaults:_.defaults({id:"insert-image",filterable:"uploaded",multiple:!1,toolbar:"insert-image",library:wp.media.query({type:"image"}),title:i.select_image,priority:60,syncSelection:!1},wp.media.controller.Library.prototype.defaults),updateSelection:function(){var e,t=this.get("selection"),i=wp.media.DethemeImageEdit.getData();""!==i&&-1!==i&&(e=wp.media.model.Attachment.get(i),e.fetch()),t.reset(e?[e]:[])}}),e(".detheme-field-image").length&&e(".detheme-field-image").each(function(){var i=e(this);i.find(".add_detheme_image").unbind("click").click(function(){wp.media.DethemeImageEdit.frame(i).open()}),i.find(".remove_detheme_image").unbind("click").click(t)})});